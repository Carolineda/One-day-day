## 浏览器

## 一个页面从输入url到页面加载显示完成 浏览器的渲染 这个过程发生了什么？
 1、浏览器的地址栏输入URL。
 2、浏览器查找当前URL是否存在缓存，并比较缓存是否过期。
 3、DNS解析URL对应的IP  域名解析 
 4、根据IP建立TCP连接（三次握手）。
 5、HTTP发起请求。
 6、服务器处理请求，浏览器接收HTTP响应。
 7、客户端解析渲染页面，构建DOM树。
 8、关闭TCP连接（四次挥手）。


## 从URL输入到页面的展现

  我们在网站的地址栏输入的字符串称URL，通过URL查找资源的具体位置。
  
  `URL`:https://www.zhihu.com/people/Oli-Zhao/columns
  
  https:协议部分
  www.zhihu.com：域名部分
  /people/Oli-Zhao/columns：资源路径部分

  `IP域名`
    1.局域网IP： 在同样一个局域网里面的连接

  `DNS`域名系统：记录域名和IP地址相互映射的信息



  `具体流程概述`
  1.输入URL
  2.浏览器查找域名对应的IP地址
      浏览器进行域名解析找到对应IP，DNS解析是浏览器寻找的方式：
        1）查找浏览器缓存——近期浏览过的网站，浏览器会缓存 DNS 记录一段时间 （如果没有则往下） ；
        2）查找系统缓存——从 C 盘的 hosts 文件查找是否有存储的 DNS 信息，查找是否有目标域名和对应的 IP 地址 （如果没有则往下）；
        3）查找路由器缓存 （如果没有则往下）；
        4）查找 ISP DNS 缓存——从网络服务商（比如电信）的 DNS 缓存信息中查找（如果没有则往下）；
        经由以上方式都没找到对应 IP 的话，就会向根域名服务器查找目标 URL 对应的 IP，根域名服务器会向下级服务器转达请求，层层下发，直到找到对应的 IP 为止。

  3.浏览器根据IP地址与 服务器建立联系  浏览器通过IP寻找到对应的服务器，发送给服务器
        `MVC模式`
        Model模型：将实际开发过程中的业务规则和所涉及的数据格式进行模型化
        view视图：用户看到交互的界面
        Controller控制器：
    （三次握手是指建立TCP连接时，需要客户端和服务器总共发送3个包，是为了确认双方的接受能力和发送能力）
    第一次握手： 客户端尝试链接服务器，向服务器发送SYN报文，指明客户端初始化序列号
    第二次握手： 服务器收到syn包，必须确认客户的SYN(ack=j+1)，同时自己也发送一个SYN包(syn=k)，即SYN+ACK包，此时服务器进入SYN_RECV状态;
    第三次握手： 客户端收到服务器的第二次握手的包，向服务器发送确认包，发送完毕，客户端和都武器进去ESTABLSHED状态

  三次握手完毕后，客户端与服务器才正式开始传送数据。

  4.浏览器与服务器通信：浏览器请求，服务器处理请求并呈现页面。
    `加载` 
        1）浏览器对HTML加载顺序从上而下，在加载的过程中，同时解析、渲染处理
        2）在遇到link标签、image标签 script。浏览器会再次向服务器发送请求获取相应的css文件、图片资源并执行js代码
      `解析 渲染`
      解析过程中就是生成树（文档对象模型）
      DOM树是由DOM元素及节点组成，加上css解析对象和js解析动作实现
      渲染：将DOM数进行可视化表示

  5.结束请求 四次挥手
    1 TCP客户端发送一个FIN报文，用来关闭客户端到服务器的数据传送
    2 服务器收到FIN报文，回送一个ACK报文，确认序号是收到的序号加一
    3 服务器关闭客服端的连接，发送一个FIN给客户端
    4 客户端收到FIN报文，向服务器发送ACK报文作为应答 


## cookie\sessionStorage\localStorage区别
HTTP是无状态的协议，对于事物处理没有记忆能力，每次客户端和服务端会话完成时，服务端不会保存任何绘画信息，每个请求都是完全独立的，无法辨认是不是同一个人、同一个浏览器
1. `Cookie`:  
    是服务器发送到浏览器保存的数据，在浏览器下次向同一个服务器再次发送请求时会被携带发送到服务器上，Cookie数据还有路径概念，存储大小4K
2. `SessionStorage`:仅在当前浏览器窗口关闭前有效，不能持久保存。
3. `localStorage`:保存数据始终有效，



`其三者区别`
1. 数据存储方面
cookie数据始终在同源的http请求中携带（即使不需要），即cookie在浏览器和服务器间来回传递。cookie数据还有路径（path）的概念，可以限制cookie只属于某个路径下
sessionStorage和localStorage不会自动把数据发送给服务器，仅在本地保存。


2. 存储数据大小
存储大小限制也不同，cookie数据不能超过4K，同时因为每次http请求都会携带cookie、所以cookie只适合保存很小的数据，如会话标识。
sessionStorage和localStorage虽然也有存储大小的限制，但比cookie大得多，可以达到5M或更大


3. 数据存储有效期
sessionStorage：仅在当前浏览器窗口关闭之前有效；
localStorage：始终有效，窗口或浏览器关闭也一直保存，本地存储，因此用作持久数据；
cookie：只在设置的cookie过期时间之前有效，即使窗口关闭或浏览器关闭


4. 作用域不同
sessionStorage不在不同的浏览器窗口中共享，即使是同一个页面；
localstorage在所有同源窗口中都是共享的；也就是说只要浏览器不关闭，数据仍然存在
cookie: 也是在所有同源窗口中都是共享的.也就是说只要浏览器不关闭，数据仍然存在


Web Storage拥有setItem、getItem、removeItem、clear等方法，不像cookie需要自己封装setCookie、getCookie等方法

5. sessionStorage与页面js数据对象的区别
页面中一般的js对象的生存期仅在当前页面有效，因此刷新页面或转到另一页面这样的重新加载页面的情况，数据就不存在了()
而sessionStorage只要同源的同窗口中，刷新页面或进入同源的不同页面，数据始终存在，也就是说只要浏览器不关闭，数据仍然存在()


## 浏览器机制（重绘和重排）
  `网页生成过程`
      1.HTML被解析成DOM树
      2.CSS被解析成CSSDOM树
      3.结合DOM和CSSDOM树，生成一颗渲染树
      4.生成布局，将所有渲染树的所有节点进行合成
      5.再将布局绘制再屏幕上

  重排： 重新生成布局，重新排列元素
  重绘： 重新生成布局，重新排列元素
  
  `重排`
    当DOM的变化元素影响几何信息，浏览器重新计算几何属性，将其重新布局，此过程叫做重排

    引起重排的方法：
      1.添加或者删除可见的DOM元素
      2.元素尺寸的改变  paadding margin border
      3.内容变化，文本框输入文字
      4.浏览器窗口的变化
      5.offsetWidth offsetHeight  获取盒子的最终的宽高的数值不带，不带单位
    
  `重绘`
    当一个元素外观发生改变，没有改变布局，重新把外观绘制出来。

    引起重绘的方法： 大部分是在修改css样式时进行的重新绘制

  优化方法：
    1.分离读写操作，集中读集中写
    2.集中样式改变
    3.脱离文档流 将position设置 absolute和fixed
    4.优化动画


  ## CDN的原理
    CDN原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时候，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上。由缓存服务器直接响应用户请求，最简单的CDN网络由一个DNS服务器和几台缓存服务器可以组成，用户输入URL，经过DNS解析，DNS系统最终将域名解析交割CDN专用的DNS服务器，将全局负载均衡设备的IP地址，用户向全局负载均设备发送内容访问的请求。



  
## 输入 POST GET
  1. Get请求   Post请求
 get  请求类似于查找的过程，用户获取数据，可以不用每次都与数据库连接，所以可以使用缓存 Get 请求都包含在 URL 里，且会被浏览器保存历史纪录,get相比post不安全
 post 一般做的是修改和删除数据的工作，所以必须与数据库交互，所以不能缓存，所以get请求更适合于请求缓存,post是加密传输
  2. URL长度限制输入的长度可以无限长度吗
HTTP协议并没有限制和url的长度，是浏览器或者Web浏览器做了url长度的限制，并且只针对get请求做出限制
  IE : 2803
  Firefox:65536
  Chrome:8182
  Safari:80000
  Opera:190000
`POST 与 GET 两者的区别`
  1.POST: post一般做的修改和删除工作，用来和数据交互。post是加密传输

  2.GET: get一般用来查找，获取数据，可用来缓存。get会将请求参数包含在URL中，相比post安全性更低，




  